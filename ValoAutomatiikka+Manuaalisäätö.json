[{"id":"944775db.30fbc","type":"tab","label":"UI + Simu","disabled":false,"info":""},{"id":"bd048952.05a938","type":"uibuilder","z":"944775db.30fbc","name":"","topic":"","url":"uibuilder","fwdInMessages":false,"allowScripts":false,"allowStyles":false,"copyIndex":true,"showfolder":false,"x":220,"y":760,"wires":[["c55515c4.2db198"],[]]},{"id":"c93ad064.11dff","type":"debug","z":"944775db.30fbc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1290,"y":700,"wires":[]},{"id":"89e3c90.b82a238","type":"switch","z":"944775db.30fbc","name":"LightCommandFilter","property":"payload.OGtopic","propertyType":"msg","rules":[{"t":"cont","v":"valot","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":440,"y":460,"wires":[["9262dbf6.0d924"]]},{"id":"f7a0bdaf.3ca92","type":"ui_slider","z":"944775db.30fbc","name":"","label":"Ilmanvaihdon teho","tooltip":"","group":"1505dada.3b9d75","order":2,"width":"0","height":"0","passthru":false,"outs":"end","topic":"power","min":0,"max":"100","step":1,"x":250,"y":400,"wires":[["e29ff554.e265c"]]},{"id":"2b5625a6.fafb72","type":"ui_gauge","z":"944775db.30fbc","name":"","group":"71aa9731.3d6798","order":1,"width":"0","height":"0","gtype":"gage","title":"Huone 1","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1680,"y":340,"wires":[]},{"id":"89556a62.955dc","type":"ui_dropdown","z":"944775db.30fbc","name":"","label":"Huone valinta","tooltip":"","place":"","group":"1505dada.3b9d75","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Huone 1","value":1,"type":"num"},{"label":"Huone 2","value":2,"type":"num"},{"label":"Huone 3","value":3,"type":"num"},{"label":"Huone 4","value":4,"type":"num"},{"label":"Käytävä","value":5,"type":"num"},{"label":"Kaikki","value":6,"type":"num"}],"payload":"","topic":"_id","x":260,"y":340,"wires":[["e29ff554.e265c"]]},{"id":"a7455d5a.36307","type":"ui_gauge","z":"944775db.30fbc","name":"","group":"71aa9731.3d6798","order":3,"width":0,"height":0,"gtype":"gage","title":"Huone 3","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1680,"y":460,"wires":[]},{"id":"b9c12dc8.1870f","type":"ui_gauge","z":"944775db.30fbc","name":"","group":"71aa9731.3d6798","order":2,"width":0,"height":0,"gtype":"gage","title":"Huone 2","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1680,"y":400,"wires":[]},{"id":"7f702b30.951454","type":"function","z":"944775db.30fbc","name":"SetAutoValue","func":"// var defaultPower = 30; // 0 - 100.\nvar isItOn = false;\nvar power;\n\nif(msg.payload[0].isItOn === false){\n    isItOn = true;\n    power = msg.payload[0].defaultPower;\n} else {\n    isItOn = false;\n    power = 5;\n    \n}\n\nvar dict = { \"_id\" : msg.payload[0]._id ,\n             \"isItOn\" : isItOn ,\n             \"power\" : power };\nmsg.payload = dict\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":460,"wires":[["35dbc605.184e32","7b584255.43dffc","ba8a9885.0a876","8f867e28.cd3048","fe0e9cac.31588","c93ad064.11dff","626ea912.59a02"]]},{"id":"35dbc605.184e32","type":"switch","z":"944775db.30fbc","name":"FilterByRooms","property":"payload._id","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"6","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":340,"wires":[["f65694a9.155928"],[]]},{"id":"2edbd6fc.3eb652","type":"ui_gauge","z":"944775db.30fbc","name":"","group":"71aa9731.3d6798","order":5,"width":0,"height":0,"gtype":"gage","title":"Käytävä","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1680,"y":580,"wires":[]},{"id":"c2030f2d.220d4","type":"ui_gauge","z":"944775db.30fbc","name":"","group":"71aa9731.3d6798","order":4,"width":0,"height":0,"gtype":"gage","title":"Huone 4","label":"units","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":1680,"y":520,"wires":[]},{"id":"ba8a9885.0a876","type":"switch","z":"944775db.30fbc","name":"FilterByRooms","property":"payload._id","propertyType":"msg","rules":[{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"6","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":460,"wires":[["b51d9182.6193b8"],[]]},{"id":"7b584255.43dffc","type":"switch","z":"944775db.30fbc","name":"FilterByRooms","property":"payload._id","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"6","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":400,"wires":[["5d3198d7.d3abf"],[]]},{"id":"8f867e28.cd3048","type":"switch","z":"944775db.30fbc","name":"FilterByRooms","property":"payload._id","propertyType":"msg","rules":[{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":520,"wires":[["5d7fd819.eea1a"],[]]},{"id":"fe0e9cac.31588","type":"switch","z":"944775db.30fbc","name":"FilterByRooms","property":"payload._id","propertyType":"msg","rules":[{"t":"eq","v":"5","vt":"num"},{"t":"eq","v":"6","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1320,"y":580,"wires":[["137e98db.ae7807"],[]]},{"id":"f65694a9.155928","type":"function","z":"944775db.30fbc","name":"ConfigurePayload","func":"msg.payload = msg.payload.power;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":340,"wires":[["2b5625a6.fafb72"]]},{"id":"5d3198d7.d3abf","type":"function","z":"944775db.30fbc","name":"ConfigurePayload","func":"msg.payload = msg.payload.power;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":400,"wires":[["b9c12dc8.1870f"]]},{"id":"b51d9182.6193b8","type":"function","z":"944775db.30fbc","name":"ConfigurePayload","func":"msg.payload = msg.payload.power;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":460,"wires":[["a7455d5a.36307"]]},{"id":"5d7fd819.eea1a","type":"function","z":"944775db.30fbc","name":"ConfigurePayload","func":"msg.payload = msg.payload.power;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":520,"wires":[["c2030f2d.220d4"]]},{"id":"137e98db.ae7807","type":"function","z":"944775db.30fbc","name":"ConfigurePayload","func":"msg.payload = msg.payload.power;\nreturn msg;","outputs":1,"noerr":0,"x":1510,"y":580,"wires":[["2edbd6fc.3eb652"]]},{"id":"82f2c228.444998","type":"mqtt in","z":"944775db.30fbc","name":"","topic":"ASE-2610/G2.3","qos":"2","datatype":"json","broker":"217aaca6.ca785c","x":240,"y":460,"wires":[["89e3c90.b82a238"]]},{"id":"b50554b6.2d9b58","type":"mqtt out","z":"944775db.30fbc","name":"","topic":"ASE-2610/G2.3","qos":"","retain":"","broker":"217aaca6.ca785c","x":660,"y":740,"wires":[]},{"id":"c55515c4.2db198","type":"function","z":"944775db.30fbc","name":"PayloadConfig","func":"var dict = { \"OGtopic\" : msg.topic ,\n             \"roomNumber\" : msg.payload};\n                \nmsg.payload = dict;\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":740,"wires":[["b50554b6.2d9b58"]]},{"id":"99eb7b14.9efd6","type":"inject","z":"944775db.30fbc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":300,"y":80,"wires":[[]]},{"id":"8623a9d0.35a258","type":"file in","z":"944775db.30fbc","name":"","filename":"/Users/ilpoviertola/Nodered/UI/lights.txt","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":560,"y":80,"wires":[["3eb3f676.27fd9a"]]},{"id":"3eb3f676.27fd9a","type":"json","z":"944775db.30fbc","name":"","property":"payload","action":"","pretty":false,"x":850,"y":80,"wires":[["caa56f68.d5ee"]]},{"id":"caa56f68.d5ee","type":"mongodb out","z":"944775db.30fbc","mongodb":"d9c515d5.fc3c7","name":"","collection":"lights","payonly":true,"upsert":false,"multi":false,"operation":"insert","x":1080,"y":80,"wires":[]},{"id":"ed975d67.6dad7","type":"comment","z":"944775db.30fbc","name":"To add data to MongoDB","info":"","x":710,"y":40,"wires":[]},{"id":"dd0f32f6.666378","type":"comment","z":"944775db.30fbc","name":"Simulator","info":"","x":440,"y":700,"wires":[]},{"id":"638fe242.978194","type":"mongodb-node","z":"944775db.30fbc","mongodb":"2545bb4.15679c4","name":"FindStatus","collection":"lights","operation":"find","upsert":false,"multi":false,"x":810,"y":460,"wires":[["7f702b30.951454"]]},{"id":"9262dbf6.0d924","type":"function","z":"944775db.30fbc","name":"FindBy_id","func":"var roomNumber = msg.payload.roomNumber;\nmsg.payload = {\"_id\" : roomNumber};\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":460,"wires":[["638fe242.978194"]]},{"id":"8030447c.4e6ee8","type":"mongodb out","z":"944775db.30fbc","mongodb":"d9c515d5.fc3c7","name":"UpdateDatabase","collection":"lights","payonly":false,"upsert":false,"multi":false,"operation":"update","x":1650,"y":640,"wires":[]},{"id":"626ea912.59a02","type":"function","z":"944775db.30fbc","name":"UpdateMongoDB","func":"var _id = msg.payload._id;\nvar isItOn = msg.payload.isItOn;\nvar power = msg.payload.power;\n \nvar newMsg = {\n  'query': {\n    \"roomNumber\" : _id\n  },\n  'payload': { \n      $set: {\n          \"isItOn\" : isItOn ,\n          \"power\" : power\n      }\n   } \n}; \nreturn newMsg;","outputs":1,"noerr":0,"x":1330,"y":640,"wires":[["8030447c.4e6ee8"]]},{"id":"81052e2a.757048","type":"function","z":"944775db.30fbc","name":"SetManualValue","func":"var isItOn = false;\nvar power;\n\nif(msg.payload.power === 0){\n    isItOn = false;\n    power = 0;\n} else {\n    isItOn = true;\n    power = msg.payload.power;\n    \n}\n\nvar dict = { \"_id\" : msg.payload._id ,\n             \"isItOn\" : isItOn ,\n             \"power\" : power };\nmsg.payload = dict\nreturn msg;","outputs":1,"noerr":0,"x":1000,"y":380,"wires":[["35dbc605.184e32","7b584255.43dffc","ba8a9885.0a876","8f867e28.cd3048","fe0e9cac.31588","626ea912.59a02","c93ad064.11dff"]]},{"id":"e29ff554.e265c","type":"join","z":"944775db.30fbc","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":510,"y":380,"wires":[["81052e2a.757048"]]},{"id":"fa50b0c3.dd98e","type":"ui_slider","z":"944775db.30fbc","name":"","label":"Oletusteho","tooltip":"","group":"1505dada.3b9d75","order":2,"width":0,"height":0,"passthru":true,"outs":"end","topic":"defaultPower","min":0,"max":"100","step":1,"x":270,"y":280,"wires":[["70865cf7.a4e294"]]},{"id":"56a6ac60.06f0dc","type":"mongodb out","z":"944775db.30fbc","mongodb":"d9c515d5.fc3c7","name":"UpdateDatabase","collection":"lights","payonly":false,"upsert":false,"multi":true,"operation":"update","x":930,"y":280,"wires":[]},{"id":"70865cf7.a4e294","type":"function","z":"944775db.30fbc","name":"UpdateMongoDB","func":"var newPower = msg.payload;\n \nvar newMsg = {\n  'query': {\n    \"defaultPower\" : { $exists: true }\n  },\n  'payload': { \n      $set: {\n          \"defaultPower\" : newPower\n      }\n   } \n}; \nreturn newMsg;","outputs":1,"noerr":0,"x":570,"y":280,"wires":[["56a6ac60.06f0dc"]]},{"id":"6ed15345.707f94","type":"debug","z":"944775db.30fbc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":970,"y":180,"wires":[]},{"id":"1505dada.3b9d75","type":"ui_group","z":"","name":"Tehon säätö","tab":"2679a11.35ca95e","order":1,"disp":true,"width":"6","collapse":false},{"id":"71aa9731.3d6798","type":"ui_group","z":"","name":"Mittarit","tab":"2679a11.35ca95e","order":2,"disp":true,"width":"6","collapse":false},{"id":"217aaca6.ca785c","type":"mqtt-broker","z":"","name":"","broker":"test.mosquitto.org","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"d9c515d5.fc3c7","type":"mongodb","z":"","hostname":"127.0.0.1","port":"27017","db":"ASE-2610","name":""},{"id":"2545bb4.15679c4","type":"mongodb-config","z":"","hostname":"127.0.0.1","port":"27017","db":"ASE-2610","name":""},{"id":"2679a11.35ca95e","type":"ui_tab","z":"","name":"UI","icon":"dashboard","order":22,"disabled":false,"hidden":false}]